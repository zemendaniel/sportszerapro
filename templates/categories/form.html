{% extends "base.html" %}

{% block title %}
{% if create %}
    Létrehozás
{% else %}
    Szerkesztés
{% endif %}
{% endblock %}

{% block head %}
{% endblock %}

{% block main %}
<a href="{{ url_for('categories.list_all') }}" class="btn btn-dark me-4 my-2" onclick="return confirmChanges()"><i class="fa fa-arrow-left"></i> Vissza</a>
{% include "categories/breadcrumb.html" %}
<form method="post" onchange="changed = true;" id="form">
    {{ form.csrf_token() }}
    <div class="form-group">
        {{ form.name.label }}
        {{ form.name(class="form-control", id='content')}}
    </div>
</form>

<div class="d-flex align-items-center">
        <button type="submit" onclick="document.getElementById('form').submit()" class="btn btn-primary-dark">
            <i class="fa-solid fa-floppy-disk"></i> Mentés
        </button>

        {% if not create %}
            <form action="{{ url_for('categories.delete', category_id=category.id) }}" method="post"
                  onsubmit='return confirm("Biztosan törli? ({{ category.name }})")' class="d-inline">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit" class="btn btn-dark mx-2">
                    <i class="fa-solid fa-trash-can"></i> Törlés
                </button>
            </form>
        {% endif %}
</div>

{% if not create and category.is_leaf %}
    <h5>Meglévő</h5>
    <ul>
        {% for attr in category.all_attributes %}
            <li>{{ attr.name }} - {{ attr.display_type }} - {{ attr.description or "nincs leírás" }} - {{ attr.is_default_display }}</li>
        {% endfor %}
    </ul>

    <h5>Lehetőségek</h5>
        <ul>
            {% for attr in attributes %}
                <li>
                    <form onchange="this.submit()" action="{{ url_for('categories.set_attributes', category_id=category.id) }}" method="post">
                        <input type="checkbox" class="me-2" name="bool_value" id="attr_{{ attr.id }}" {% if attr in category.all_attributes %}checked{% endif %}>
                        <input type="hidden" name="attribute_id" value="{{ attr.id }}">
                        <label for="attr_{{ attr.id }}">{{ attr.name }} - {{ attr.display_type }} - {{ attr.description or "nincs leírás" }} - {{ attr.is_default_display }}</label>
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    </form>
                </li>
            {% endfor %}
        </ul>
{% endif %}

<script>
    let changed = false;
</script>

{% endblock %}
